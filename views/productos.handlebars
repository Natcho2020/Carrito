<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart Js</title>

</head>

<body>
    <header>
        <div class="header-section container">
            <img class="logo" src="photos/logoShop.png" alt="">
            <div>
                <img onclick="showCart(this)" class="cart" src="photos/cart.png" alt="">
                <p class="count-product">0</p>
            </div>
            <div class="cart-products" id="products-id">
                <p class="close-btn" onclick="closeBtn()">X</p>
                <h3>Mi carrito</h3>
                <div class="card-items">
                    <!-- <div class="item">
                        <img src="./images/products/keyboard-1.jpg" alt="">
                        <div class="item-content">
                            <h5>name of product name of product name of product</h5>
                            <h5 class="cart-price">45.50$</h5>
                            <h6>Amount: 3</h6>
                        </div>
                        <span>X</span>
                    </div>
    
                    <div class="item">
                        <img src="./images/products/keyboard-1.jpg" alt="">
                        <div class="item-content">
                            <h5>name of product name of product name of product</h5>
                            <h5 class="cart-price">45.50$</h5>
                            <h6>Amount: 3</h6>
                        </div>
                        <span class="delete-product" data-id="">X</span>
                    </div> -->
                </div>
                <h2>Total: $<strong class="price-total">0</strong></h2>
            </div>
        </div>
    </header>
    <section class="container">
        <div class="products">
            <div class="carts">
                <div>
                    <img src="/photos/products/keyboard-1.jpg" alt="">
                    <p><span>20</span>$</p>
                </div>
                <p class="title">Tempest Cataclysm Combo 3 En 1 Gaming Teclado</p>
                <a href="" data-id="1" class="btn-add-cart">add to cart</a>
            </div>
            <div class="carts">
                <div>
                    <img src="/photos/products/keyboard-2.jpg" alt="">
                    <p><span>35</span>$</p>
                </div>
                <p class="title"> Newskill Suiko Ivory Teclado Mec치nico Gaming Full RGB</p>
                <a href="" class="btn-add-cart" data-id="2">add to cart</a>
            </div>
            <div class="carts">
                <div>
                    <img src="./images/products/keyboard-3.jpg" alt="">
                    <p><span>15.50</span>$</p>
                </div>
                <p class="title"> Aukey KM-G16 Teclado Mec치nico Gaming Retroiluminado</p>
                <a href="" data-id="3" class="btn-add-cart">add to cart</a>
            </div>
            <div class="carts">
                <div>
                    <img src="./images/products/keyboard-4.jpg" alt="">
                    <p><span>20.20</span>$</p>
                </div>
                <p class="title"> Razer Huntsman Elite Teclado Mec치nico Gaming RGB</p>
                <a href="" data-id="4" class="btn-add-cart">add to cart</a>
            </div>
            <div class="carts">
                <div>
                    <img src="./images/products/keyboard-5.jpg" alt="">
                    <p><span>19</span>$</p>
                </div>
                <p class="title"> Trust GXT 856 Torac Teclado Met치lico Gaming RGB</p>
                <a href="" data-id="5" class="btn-add-cart">add to cart</a>
            </div>
            <div class="carts">
                <div>
                    <img src="./images/products/keyboard-1.jpg" alt="">
                    <p><span>45</span>$</p>
                </div>
                <p class="title"> MSI Vigor GK30 Teclado Gaming RGB</p>
                <a href="" data-id="6" class="btn-add-cart">add to cart</a>
            </div>
            <div class="carts">
                <div>
                    <img src="./images/products/keyboard-2.jpg" alt="">
                    <p><span>23.99</span>$</p>
                </div>
                <p class="title"> Genesis Thor 300 RGB Teclado Mec치nico Gaming RGB Switch Rojo</p>
                <a href="" data-id="7" class="btn-add-cart">add to cart</a>
            </div>
            <div class="carts">
                <div>
                    <img src="./images/products/keyboard-3.jpg" alt="">
                    <p><span>50</span>$</p>
                </div>
                <p class="title"> Mars Gaming MKXTKL Teclado Mec치nico Gaming RGB</p>
                <a href="" data-id="8" class="btn-add-cart">add to cart</a>
            </div>
            <div class="carts">
                <div>
                    <img src="/photos/keyboard-4.jpg" alt="">
                    <p><span>16</span>$</p>
                </div>
                <p class="title"> Trust GXT 881 Odyss Teclado Gaming Semi-Mec치nico RGB</p>
                <a href="" data-id="9" class="btn-add-cart">add to cart</a>
            </div>
            <div class="carts">
                <div>
                    <img src="./images/products/keyboard-5.jpg" alt="">
                    <p><span>17.50</span>$</p>
                </div>
                <p class="title"> Krom Krusher Teclado Gaming H칤brido RGB + Rat칩n</p>
                <a href="" data-id="10" class="btn-add-cart">add to cart</a>
            </div>
            <div class="carts">
                <div>
                    <img src="/products/keyboard-1.jpg" alt="">
                    <p><span>45</span>$</p>
                </div>
                <p class="title"> Corsair K55 RGB PRO XT Teclado Gaming Retroiluminado Negro</p>
                <a href="" data-id="11" class="btn-add-cart">add to cart</a>
            </div>
        </div>
    </section>

    <footer>
        <p class="author">游뿛 by <a href="https://github.com/garu2" target="_blank">GaryAT</a></p>
    </footer>

    <script>
        function showCart(x) {
            document.getElementById("products-id").style.display = "block";
        }
        function closeBtn() {
            document.getElementById("products-id").style.display = "none";
        }

    </script>
    <script>
        //variables
        let allContainerCart = document.querySelector('.products');
        let containerBuyCart = document.querySelector('.card-items');
        let priceTotal = document.querySelector('.price-total')
        let amountProduct = document.querySelector('.count-product');


        let buyThings = [];
        let totalCard = 0;
        let countProduct = 0;

        //functions
        loadEventListenrs();
        function loadEventListenrs() {
            allContainerCart.addEventListener('click', addProduct);

            containerBuyCart.addEventListener('click', deleteProduct);
        }

        function addProduct(e) {
            e.preventDefault();
            if (e.target.classList.contains('btn-add-cart')) {
                const selectProduct = e.target.parentElement;
                readTheContent(selectProduct);
            }
        }

        function deleteProduct(e) {
            if (e.target.classList.contains('delete-product')) {
                const deleteId = e.target.getAttribute('data-id');

                buyThings.forEach(value => {
                    if (value.id == deleteId) {
                        let priceReduce = parseFloat(value.price) * parseFloat(value.amount);
                        totalCard = totalCard - priceReduce;
                        totalCard = totalCard.toFixed(2);
                    }
                });
                buyThings = buyThings.filter(product => product.id !== deleteId);

                countProduct--;
            }
            //FIX: El contador se quedaba con "1" aunque ubiera 0 productos
            if (buyThings.length === 0) {
                priceTotal.innerHTML = 0;
                amountProduct.innerHTML = 0;
            }
            loadHtml();
        }

        function readTheContent(product) {
            const infoProduct = {
                image: product.querySelector('div img').src,
                title: product.querySelector('.title').textContent,
                price: product.querySelector('div p span').textContent,
                id: product.querySelector('a').getAttribute('data-id'),
                amount: 1
            }

            totalCard = parseFloat(totalCard) + parseFloat(infoProduct.price);
            totalCard = totalCard.toFixed(2);

            const exist = buyThings.some(product => product.id === infoProduct.id);
            if (exist) {
                const pro = buyThings.map(product => {
                    if (product.id === infoProduct.id) {
                        product.amount++;
                        return product;
                    } else {
                        return product
                    }
                });
                buyThings = [...pro];
            } else {
                buyThings = [...buyThings, infoProduct]
                countProduct++;
            }
            loadHtml();
            //console.log(infoProduct);
        }

        function loadHtml() {
            clearHtml();
            buyThings.forEach(product => {
                const { image, title, price, amount, id } = product;
                const row = document.createElement('div');
                row.classList.add('item');
                row.innerHTML = `
            <img src="${image}" alt="">
            <div class="item-content">
                <h5>${title}</h5>
                <h5 class="cart-price">${price}$</h5>
                <h6>Amount: ${amount}</h6>
            </div>
            <span class="delete-product" data-id="${id}">X</span>
        `;

                containerBuyCart.appendChild(row);

                priceTotal.innerHTML = totalCard;

                amountProduct.innerHTML = countProduct;
            });
        }
        function clearHtml() {
            containerBuyCart.innerHTML = '';
        }
    </script>
</body>

</html>